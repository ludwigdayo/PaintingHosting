webpackJsonp([1],{"7s/B":function(t,e){},GOe9:function(t,e){},JEGo:function(t,e){},NHnr:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("7+uW"),i=a("Dd8w"),s=a.n(i),o=a("NYxO"),r={name:"Header",computed:s()({},Object(o.c)(["tags","selectedTag"]),{selectedTagStr:{get:function(){return this.selectedTag},set:function(t){this.$store.commit("setSelectedTag",t)}}}),methods:s()({},Object(o.b)(["setNextPage","setLastPage"]),{backtrack:function(){},reset:function(){this.$store.commit("setSelectedTag",""),"/home"!==this.$route.path&&this.$router.push("/home"),console.log("重置页面")}})},c={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container"},[a("header",{staticClass:"header-wrap"},[a("nav",{staticClass:"nav"},[a("div",{staticClass:"nav-link",on:{click:t.reset}},[t._v("大厅")]),t._v(" "),a("router-link",{staticClass:"nav-link",attrs:{to:"/upload"}},[t._v("上传")])],1),t._v(" "),a("div",{staticClass:"header-bar"},["/home"===t.$route.path?a("div",[a("div",{staticClass:"custom-select"},[a("select",{directives:[{name:"model",rawName:"v-model",value:t.selectedTagStr,expression:"selectedTagStr"}],staticClass:"select-box",on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.selectedTagStr=e.target.multiple?a:a[0]}}},[a("option",{attrs:{value:""}},[t._v("全部标签")]),t._v(" "),t._l(t.tags,function(e){return a("option",{key:e,domProps:{value:e,selected:e===t.selectedTag}},[t._v("\n                            "+t._s(e)+"\n                        ")])})],2),t._v(" "),a("span",{staticClass:"arrow"})])]):t._e()])])])},staticRenderFns:[]};var u={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"container"},[e("footer",{staticClass:"footer"},[e("p",[this._v("一个图片托管展示服务器")])])])}]};var m={name:"App",components:{"vue-header":a("VU/8")(r,c,!1,function(t){a("vXjD")},"data-v-1cfea00a",null).exports,"vue-footer":a("VU/8")({name:"Footer"},u,!1,function(t){a("JEGo")},"data-v-08ae87fa",null).exports}},l={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("vue-header"),this._v(" "),e("div",{staticClass:"content"},[e("router-view")],1),this._v(" "),e("vue-footer")],1)},staticRenderFns:[]};var d=a("VU/8")(m,l,!1,function(t){a("7s/B")},"data-v-b32a93a6",null).exports,g=a("/ocq"),h=a("lHA8"),v=a.n(h),p=a("Gu7T"),f=a.n(p),_=a("mtWM").a.create({baseURL:"http://localhost:80/"}),I={name:"Home",data:function(){return{imageDataList:[],imageNow:{isHovered:!1,image:null}}},mounted:function(){this.fetchImages(this.start,this.end)},computed:s()({},Object(o.c)(["selectedTag","start","end"]),{imageRows:function(){for(var t=[],e=0;e<this.filteredImage.length;e+=4)t.push(this.filteredImage.slice(e,e+4));return t},filteredImage:function(){var t=this;return""!==this.selectedTag?(console.log("按标签过滤"),console.log("此时的过滤："+this.selectedTag),this.imageDataList.filter(function(e){return e.metadata.tags.split(",").includes(t.selectedTag)})):this.imageDataList}}),methods:{getImageSrc:function(t){return"data:image/png;base64, "+t},fetchImages:function(t,e){var a=this;_.get("/images?start="+t+"&end="+e+"&isThumbnail=true").then(function(t){a.imageDataList=t.data,console.log(a.imageDataList);var e=[].concat(f()(new v.a(a.imageDataList.flatMap(function(t){return t.metadata.tags.split(",")}))));a.$store.commit("setTags",e),console.log(e)}).catch(function(t){console.error(t)})},showImageMessage:function(t,e){this.imageNow.image=e,this.imageNow.isHovered=!0;t.target.nextSibling;var a=t.clientX+"px",n=t.clientY+"px";this.imageNow.topValue=n,this.imageNow.leftValue=a},hideImageMessage:function(t,e){this.imageNow.image=null,this.imageNow.isHovered=!1},goToDetails:function(t){this.$router.push("/details/"+t)}}},C={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container"},[t._l(t.imageRows,function(e,n){return a("div",{key:n,staticClass:"image-row"},t._l(e,function(e){return a("div",{key:e.metadata.id,staticClass:"image-container"},[a("div",{staticClass:"image-container-inner"},[a("div",{staticClass:"image-wrapper",on:{mouseover:function(a){return t.showImageMessage(a,e)},mouseleave:function(a){return t.hideImageMessage(a,e)}}},[a("img",{staticClass:"rounded-image",attrs:{src:t.getImageSrc(e.image),alt:"Image"},on:{click:function(a){return t.goToDetails(e.metadata.id)}}})]),t._v(" "),a("div",{staticClass:"image-info"},[a("p",{staticClass:"image-name"},[t._v(t._s(e.metadata.imageName))])])])])}),0)}),t._v(" "),t.imageNow.isHovered?a("div",{staticClass:"image-message",style:{top:t.imageNow.topValue,left:t.imageNow.leftValue}},[t._v("\n        作者："+t._s(t.imageNow.image.metadata.author)+"，时间： "+t._s(t.imageNow.image.metadata.createTime))]):t._e()],2)},staticRenderFns:[]};var w=a("VU/8")(I,C,!1,function(t){a("p3v/")},"data-v-c994d40a",null).exports,T=a("BO1k"),y=a.n(T),b={name:"Upload",data:function(){return{imageName:"",author:"",createTime:"",story:"",price:0,image:null,tags:"",showSuccess:!1}},methods:{handleImageInputChange:function(t){this.image=t.target.files[0]},submitImage:function(){var t=this,e=new FormData;e.append("imageName",this.imageName),e.append("author",this.author),e.append("createTime",this.createTime),e.append("story",this.story),e.append("price",this.price),e.append("image",this.image),e.append("tags",this.tags);var a=!0,n=!1,i=void 0;try{for(var s,o=y()(e.entries());!(a=(s=o.next()).done);a=!0){var r=s.value;console.log(r[0]+", "+r[1])}}catch(t){n=!0,i=t}finally{try{!a&&o.return&&o.return()}finally{if(n)throw i}}_.post("/upload",e).then(function(e){t.showSuccess=!0,setTimeout(function(){t.showSuccess=!1},2e3),t.resetForm()}).catch(function(t){console.error("Failed to submit image:",t)})},resetForm:function(){this.imageName="",this.author="",this.createTime="",this.story="",this.price="",this.image=null,this.tags=""}}},N={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("label",{attrs:{for:"imageName"}},[t._v("图像名称:")]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.imageName,expression:"imageName"}],attrs:{type:"text",id:"imageName"},domProps:{value:t.imageName},on:{input:function(e){e.target.composing||(t.imageName=e.target.value)}}}),t._v(" "),a("label",{attrs:{for:"author"}},[t._v("作者:")]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.author,expression:"author"}],attrs:{type:"text",id:"author"},domProps:{value:t.author},on:{input:function(e){e.target.composing||(t.author=e.target.value)}}}),t._v(" "),a("label",{attrs:{for:"createTime"}},[t._v("创作时间:")]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.createTime,expression:"createTime"}],attrs:{type:"text",id:"createTime"},domProps:{value:t.createTime},on:{input:function(e){e.target.composing||(t.createTime=e.target.value)}}}),t._v(" "),a("label",{attrs:{for:"story"}},[t._v("故事:")]),t._v(" "),a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.story,expression:"story"}],attrs:{id:"story"},domProps:{value:t.story},on:{input:function(e){e.target.composing||(t.story=e.target.value)}}}),t._v(" "),a("label",{attrs:{for:"price"}},[t._v("价格:")]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.price,expression:"price"}],attrs:{type:"number",id:"price"},domProps:{value:t.price},on:{input:function(e){e.target.composing||(t.price=e.target.value)}}}),t._v(" "),a("label",{attrs:{for:"image"}},[t._v("Image:")]),t._v(" "),a("input",{ref:"imageInput",attrs:{type:"file",id:"image"},on:{change:t.handleImageInputChange}}),t._v(" "),a("label",{attrs:{for:"tags"}},[t._v("标签(逗号分隔):")]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.tags,expression:"tags"}],attrs:{type:"text",id:"tags"},domProps:{value:t.tags},on:{input:function(e){e.target.composing||(t.tags=e.target.value)}}}),t._v(" "),a("button",{on:{click:t.submitImage}},[t._v("Upload")]),t._v(" "),t.showSuccess?a("div",{staticClass:"success-message"},[t._v("\n        Image uploaded successfully!\n    ")]):t._e()])},staticRenderFns:[]};var k=a("VU/8")(b,N,!1,function(t){a("GOe9")},"data-v-5be2e50c",null).exports,x={name:"Details",data:function(){return{imageData:{image:null},imageInteract:{Like:0,Favorite:0,Comment:""},index:0,showSuccess:!1,showError:!1,commentInput:""}},mounted:function(){if(void 0==this.$route.params.id)return console.log("参数不对"),void this.$router.push("/home");this.index=this.$route.params.id,this.fetchImages()},computed:{splitComments:function(){return this.imageInteract.Comment.split(",")}},methods:{addLike:function(){console.log("Like+1"),this.sendInteractInfo(!1,this.imageInteract.Like+1,this.imageInteract.Favorite,this.imageInteract.Comment)},addFavorite:function(){console.log("Favorite+1"),this.sendInteractInfo(!1,this.imageInteract.Like,this.imageInteract.Favorite+1,this.imageInteract.Comment)},handleTagClick:function(t){this.$store.commit("setSelectedTag",t),this.$router.push("/home")},getImageSrc:function(t){return"data:image/png;base64, "+t},fetchImages:function(){var t=this;console.log("id:"+this.index),_.get("/images?start="+this.index+"&end="+this.index+"&isThumbnail=false").then(function(e){t.imageData=e.data[0],console.log("查到:"+t.imageData)}).catch(function(t){console.error(t)}),this.getInteract()},getInteract:function(){var t=this;_.get("/interact?imageId="+this.index).then(function(e){t.imageInteract=e.data}).catch(function(t){console.error(t)})},goToAuthor:function(t){this.$router.push("/author/"+t)},sendInteractInfo:function(t,e,a,n){var i=this,s=new FormData;s.append("ImageId",this.index),s.append("Like",e),s.append("Favorite",a),s.append("Comment",n),_.post("/interactUpload",s).then(function(e){i.getInteract(),t&&(i.showSuccess=!0,setTimeout(function(){i.showSuccess=!1},2e3)),i.commentInput=""}).catch(function(t){i.showError=!0,setTimeout(function(){i.showError=!1},2e3),console.error(t)})},dealInteractInfo:function(){if(""!==this.commentInput){var t=this.imageInteract.Comment+","+this.commentInput;this.sendInteractInfo(!0,this.imageInteract.Like,this.imageInteract.Favorite,t)}}}},D={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.imageData.image?a("div",{staticClass:"container"},[a("div",{staticClass:"container-inner-info"},[a("div",{staticClass:"image-wrapper"},[a("img",{staticClass:"rounded-image",attrs:{src:t.getImageSrc(t.imageData.image),alt:"Image"}}),t._v(" "),a("div",{attrs:{id:"image-story"}},[t._v(t._s(t.imageData.metadata.story))])]),t._v(" "),a("div",{staticClass:"image-info"},[a("table",[a("tr",{staticClass:"clickable"},[a("td",[t._v("\n                        名称\n                    ")]),t._v(" "),a("td",[t._v("\n                        "+t._s(t.imageData.metadata.imageName)+"\n                    ")])]),t._v(" "),a("tr",{staticClass:"clickable",on:{click:function(e){return t.goToAuthor(t.imageData.metadata.author)}}},[a("td",[t._v("\n                        作者\n                    ")]),t._v(" "),a("td",{staticClass:"clickableTag"},[t._v("\n                        "+t._s(t.imageData.metadata.author)+"\n                    ")])]),t._v(" "),a("tr",{staticClass:"clickable"},[a("td",[t._v("\n                        时间\n                    ")]),t._v(" "),a("td",[t._v("\n                        "+t._s(t.imageData.metadata.createTime)+"\n                    ")])]),t._v(" "),a("tr",{staticClass:"clickable"},[a("td",[t._v("\n                        价格\n                    ")]),t._v(" "),a("td",[t._v("\n                        "+t._s(t.imageData.metadata.price)+"\n                    ")])]),t._v(" "),a("tr",{staticClass:"clickable"},[a("td",[t._v("\n                        标签\n                    ")]),t._v(" "),a("td",t._l(t.imageData.metadata.tags.split(","),function(e){return a("span",{key:e,staticClass:"clickableTag",on:{click:function(a){return t.handleTagClick(e)}}},[t._v("\n                            "+t._s(e)+"\n                        ")])}),0)])])])]),t._v(" "),a("div",{staticClass:"container-inner-interact"},[a("div",{staticClass:"interact-wrapper"},[a("div",{staticClass:"interact-item",on:{click:t.addLike}},[a("i",{staticClass:"far fa-heart",staticStyle:{cursor:"pointer"}}),t._v(" "),a("span",{staticClass:"interact-item-text"},[t._v(t._s(t.imageInteract.Like))])]),t._v(" "),a("div",{staticClass:"interact-item",on:{click:t.addFavorite}},[a("i",{staticClass:"far fa-thumbs-up",staticStyle:{cursor:"pointer"}}),t._v(" "),a("span",{staticClass:"interact-item-text"},[t._v(t._s(t.imageInteract.Favorite))])])]),t._v(" "),a("div",{staticClass:"interact-item comment-container"},[t._l(t.splitComments,function(e,n){return a("p",{key:n,staticClass:"comment-content"},[t._v(t._s(e))])}),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.commentInput,expression:"commentInput"}],staticClass:"comment-container-input",attrs:{type:"text",placeholder:"发表你的感想"},domProps:{value:t.commentInput},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.dealInteractInfo.apply(null,arguments)},input:function(e){e.target.composing||(t.commentInput=e.target.value)}}})],2),t._v(" "),t.showError?a("div",{staticClass:"error-message"},[t._v("\n            Interact upload failed!\n        ")]):t._e()])]):t._e()},staticRenderFns:[]};var S=a("VU/8")(x,D,!1,function(t){a("z1Ho")},"data-v-bb9ab972",null).exports,$={name:"Author",data:function(){return{author:{AuthorName:"",Introduce:"",Image:""},showSuccess:!1}},mounted:function(){if(console.log("进入作者详情页面"),void 0==this.$route.params.author)return console.log("参数不对"),void this.$router.push("/home");this.author.AuthorName=this.$route.params.author,this.fetchAuthor(this.$route.params.author)},computed:{displayImage:function(){return"data:image/jpeg;base64, "+this.author.Image}},methods:{uploadAuthorInfo:function(){var t=this,e=new FormData;e.append("authorName",this.author.AuthorName),e.append("introduce",this.author.Introduce),console.log("Send Image introduce:"+this.author.Introduce),e.append("image",this.author.Image),_.post("/authorUpload",e).then(function(e){t.showSuccess=!0,setTimeout(function(){t.showSuccess=!1},1500),t.resetForm()}).catch(function(t){})},handleDrop:function(t){var e=this;t.preventDefault();var a=t.dataTransfer.files;if(a.length>0){var n=a[0];if(!n.type.startsWith("image/"))return void console.log("你他娘的放的什么几把");var i=new FileReader;i.onload=function(){e.author.Image=i.result.split(",")[1],console.log("读取成功"),e.uploadAuthorInfo()},i.readAsDataURL(n)}},getImageSrc:function(t){return"data:image/png;base64, "+t},fetchAuthor:function(t){var e=this;console.log("author:"+t),_.get("/author?authorName="+t).then(function(t){e.author=t.data,console.log("查到："),console.log(e.author)}).catch(function(t){})}}},F={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container",on:{dragover:function(t){t.preventDefault()},drop:t.handleDrop}},[a("div",{staticClass:"image-introduce"},[t.author.Image?a("img",{staticClass:"rounded-image",attrs:{src:t.displayImage,alt:"Image"}}):t._e(),t._v(" "),a("h2",{staticClass:"author-name"},[t._v(t._s(t.author.AuthorName))])]),t._v(" "),a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.author.Introduce,expression:"author.Introduce"}],staticClass:"introduce",domProps:{value:t.author.Introduce},on:{blur:t.uploadAuthorInfo,input:function(e){e.target.composing||t.$set(t.author,"Introduce",e.target.value)}}}),t._v(" "),t.showSuccess?a("div",{staticClass:"success-message"},[t._v("\n        Image uploaded successfully!\n    ")]):t._e()])},staticRenderFns:[]};var A=a("VU/8")($,F,!1,function(t){a("ouV+")},"data-v-c89d1c38",null).exports;n.a.use(g.a);var L=new g.a({routes:[{path:"/",redirect:"/home"},{path:"/home",name:"Home",component:w},{path:"/upload",name:"Upload",component:k},{path:"/details/:id",name:"Details",component:S},{path:"/author/:author",name:"Author",component:A}]});n.a.use(o.a);var E=new o.a.Store({state:{tags:[],selectedTag:"",start:0,end:100},mutations:{setTags:function(t,e){t.tags=e},setSelectedTag:function(t,e){console.log("在store设置标签"+e),t.selectedTag=e}}});a("ao2D");n.a.config.productionTip=!1,new n.a({el:"#app",router:L,store:E,components:{App:d},template:"<App/>"})},ao2D:function(t,e){},"ouV+":function(t,e){},"p3v/":function(t,e){},vXjD:function(t,e){},z1Ho:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.ecbf4e74b857aad7d25a.js.map